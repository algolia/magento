language: ruby

rvm:
  - 2.3.1

branches:
  only:
    - master

before_install:
  # install newer NodeJS
  # - sudo apt-get purge nodejs npm
  # - wget -qO- https://deb.nodesource.com/setup_4.x | sudo bash -
  # - sudo apt-get install nodejs
  - sudo apt-get install npm
  - sudo npm cache clean -f
  - sudo npm install -g n
  - sudo n stable
  - node -v
  # install yarn
  # - curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | sudo apt-key add -
  # - echo "deb https://dl.yarnpkg.com/debian/ stable main" | sudo tee /etc/apt/sources.list.d/yarn.list
  # - sudo apt-get update && sudo apt-get install yarn

script:
  - yarn install && node buildComponents.js
  - bundle exec jekyll build
  - bundle exec htmlproofer ./_site --url-swap "^/magento:" --only-4xx --allow-hash-href

env:
  global:
    - NOKOGIRI_USE_SYSTEM_LIBRARIES=true # speeds up installation of html-proofer